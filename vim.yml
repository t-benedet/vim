
---
- hosts: all
  gather_facts: true
  become: true
  become_user: root
  tasks:
    - apt:
        name: vim

    - name: Check if vim is installed
      command: dpkg-query -l vim
      register: deb_check

    - name: Execute script if vim is not installed
      command: somescript
    when: deb_check.stdout.find('no packages found') != -1
